#!/bin/sh

# When this script is called, it's expected to create any build artifacts your
# application needs in order to be started. When we're performing a build of
# your application in preparation for building a deploy image, you'll know, via
# the $BUILD_TARGET environment variable. If you need to take special steps in
# order to prep for creating a deployable image, do so based on this.

. $PWD/cz/environment

echo "$CZ_APP_NAME ($CZ_APP_VERSION) building for $ENVIRONMENT..."

# We'll want to build/vendor our gems from within the container, if we want to
# be able to run our app within the container.
bundle install --clean

# For Rails apps, we'll want to refresh our precompiled assets in preparation
# for a deploy.
if [ "$BUILD_TARGET" == "deploy" ]
then
  bin/rake assets:clobber
  bin/rake assets:precompile
fi
